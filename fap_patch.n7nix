--- ./libfap-1.4.orig/src/fap.c	2014-12-01 10:06:32.000000000 -0800
+++ ./libfap-1.4/src/fap.c	2014-12-01 13:06:10.849750029 -0800
@@ -165,9 +165,10 @@
 	}
 
 	/* Save the original packet. */
-	result->orig_packet = malloc(input_len);
+	result->orig_packet = malloc(input_len+1);
 	result->orig_packet_len = input_len;
 	memcpy(result->orig_packet, input, input_len);
+	*(result->orig_packet+input_len) = '\0';
 
 	/* Find the end of header checking for NULL bytes while doing it. */
 	splitpos = 0;
@@ -455,6 +456,9 @@
 	else if ( typechar == '}' )
 	{
 		/* Come here to avoid the "when all else fails" option. */
+		result->type = malloc(sizeof(fap_packet_type_t));
+		if ( !result->type ) return result;
+		*result->type = fapTHIRD_PARTY;
 	}
 	/* When all else fails, try to look for a !-position that can occur
 	   anywhere within the 40 first characters according to the spec. */
@@ -1124,7 +1128,7 @@
 				/* Yes, lets do some checks. */
 				if ( header_len < 14 || header_len % 7 != 0 )
 				{
-					sprintf(output, "Invalid header lenght (%d).", header_len);
+					sprintf(output, "Invalid header length (%d).", header_len);
 					output_len = strlen(output)+1;
 					retval = 0;
 					break;
@@ -1161,16 +1165,14 @@
 				else if ( header_len == 14 )
 				{
 					/* We have a source callsign, copy it to the final frame directly. */
-					sprintf(output, "%s>%s", checked_call, dst_callsign);
-					output_len = strlen(checked_call) + 1 + strlen(dst_callsign);
+					output_len = sprintf(output, "%s>%s", checked_call, dst_callsign);
 					free(dst_callsign);
 					free(checked_call);
 				}
 				else if ( header_len > 14 )
 				{
 					/* We're at path part, save the call. */
-					sprintf(output+output_len, "%s", checked_call);
-					output_len += strlen(checked_call);
+					output_len += sprintf(output+output_len, "%s", checked_call);
 					free(checked_call);
 					/* Get the has-been-repeated flag. */
 					if ( charri & 0x80 )
--- ./libfap-1.4.orig/src/helpers.c	2014-11-23 04:33:55.000000000 -0800
+++ ./libfap-1.4/src/helpers.c	2014-12-01 12:59:02.227352232 -0800
@@ -620,7 +620,7 @@
 	/* If there's something left, create working copy of it. */
 	if ( (len = input_len - 8) > 0 )
 	{
-		rest = malloc(len);
+		rest = malloc(len+1);
 		memcpy(rest, input+8, len);
 	}
 	else
@@ -2549,7 +2549,7 @@
 	}
 	else
 	{
-		packet->status = malloc(input_len);
+		packet->status = malloc(input_len + 1);
 		if ( !packet->status ) return 0;
 		memcpy(packet->status, input, input_len);
 		packet->status_len = input_len;
--- ./libfap-1.4.orig/src/fap.h	2014-11-23 04:33:55.000000000 -0800
+++ ./libfap-1.4/src/fap.h	2014-12-01 12:51:49.398568666 -0800
@@ -158,6 +158,7 @@
 	fapTELEMETRY,
 	fapTELEMETRY_MESSAGE,
 	fapDX_SPOT,
+	fapTHIRD_PARTY,
 
 	fapEXPERIMENTAL
 } fap_packet_type_t;
